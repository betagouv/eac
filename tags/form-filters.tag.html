<form-filters>
  <details title=Domaine open>
    <summary>Filtrer par domaine</summary>
    <label each={ domain in this.domains }>
      <input type=checkbox name=domains value={ domain } onchange={ this.submit } checked={ this.filters.domains && this.filters.domains.includes(domain) }>
      { domain }
    </label>
  </details>

  <script>
    (async _ => {
      this.domains = await api('/domains')
      this.filters = opts.filters
      this.update()
    })()

    this.submit = (event) => {
      const q = opts.q
      const filters = opts.filters
      const category = event.target.name
      const value = event.target.value
      const activate = event.target.checked
      
      if(!filters[category]) filters[category] = []
      if(activate) {
        if(filters[category].indexOf(value) < 0) filters[category].push(value)
      }
      else filters[category].splice(filters[category].indexOf(value), 1)
      if(!filters[category].length) delete filters[category]
      page(`/search/${q}/${JSON.stringify(filters)}`)
    }
  </script>

  <style scoped>
    label {
      font-weight: normal;
      cursor: pointer;
    }
  </style>
</form-filters>
