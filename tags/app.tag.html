<app>
  <header>
    <a id=beta href=https://beta.gouv.fr>
      <img src=/images/marianne-betagouv.svg>
    </a>
    <a href="/">
      <img id=logo src=/images/logo-eac.gif alt="Logo de la Plateforme EAC">
      <h1>Plateforme EAC</h1>
      <h2>L'Éducation artistique et culturelle à portée de main</h2>
    </a>

    <section>
      <p>Trouvez les activités artistiques et culturelles au plus proche de vous</p>
      <search-form q={ this.q } school-id={ this.schoolId } />
    </section>
    <small>Si vous avez déjà un projet, vous pouvez <request-button>le soumettre à l'équipe</request-button> qui se charge de vous mettre en relation.</small>
  </header>



  <main ref=container></main>

  <footer>
    <nav>
      <h2>Autour de cette plateforme</h2>
      <a href=mailto:plateforme.eac@culture.gouv.fr>Contacter l'équipe</a>
      <a href=/intro>À propos du projet</a>
      <a href=https://github.com/betagouv/eac>Code source</a>
    </nav>

    <section>
      <a href=https://culture.gouv.fr><img src=/images/marianne-culture.jpg></a>
    </section>
  </footer>


  <script>
    /* global page, riot, urlParams, window */

    this.q = ''

    if (window.location.hostname !== 'localhost') {
      let currentUrl = window.location.href
      const _paq = window._paq
      page('*', (ctx, next) => {
        _paq.push(['setReferrerUrl', currentUrl])
        currentUrl = ctx.path
        _paq.push(['setCustomUrl', currentUrl])
        _paq.push(['setDocumentTitle', 'EAC page'])

        // remove all previously assigned custom variables, requires Matomo (formerly Piwik) 3.0.2
        _paq.push(['deleteCustomVariables', 'page'])
        _paq.push(['setGenerationTimeMs', 0])
        _paq.push(['trackPageView'])

        // make Matomo aware of newly added content
        var content = document.querySelector('main')
        _paq.push(['MediaAnalytics::scanForMedia', content])
        _paq.push(['FormAnalytics::scanForForms', content])
        _paq.push(['trackContentImpressionsWithinNode', content])
        next()
      })
    }

    page('/', (ctx) => {
      this.refs.container.innerHTML = '<page-home />'
      riot.mount('page-home')
      this.update()
    })

    page('/intro', (ctx) => {
      this.refs.container.innerHTML = '<page-intro />'
      riot.mount('page-intro')
      this.update()
    })

    page('/search', (ctx) => {
      const params = urlParams(ctx.querystring)
      this.q = decodeURI(params.get('q') || '')
      this.schoolId = params.get('school') || ''
      const filters = encodeURI(params.get('filters') || '')
      this.refs.container.innerHTML = `<page-search
        school-id="${this.schoolId}"
        q="${this.q}"
        filters="${filters}"
        />`
      riot.mount('page-search')
      this.update()
    })

    page('/actor/create', ctx => {
      this.refs.container.innerHTML = `<page-actor-edit/>`
      riot.mount('page-actor-edit')
      this.update()
    })

    page('/actor/:id/edit', ctx => {
      this.refs.container.innerHTML = `<page-actor-edit actor-id="${ctx.params.id}"/>`
      riot.mount('page-actor-edit')
      this.update()
    })

    page('/actor/:id', (ctx) => {
      this.schoolId = urlParams(ctx.querystring).get('school') || ''
      this.refs.container.innerHTML = `<page-actor
        school-id="${this.schoolId}"
        actor-id="${ctx.params.id}"
        />`
      riot.mount('page-actor')
      this.update()
    })

    page('/action/:id', (ctx) => {
      this.schoolId = urlParams(ctx.querystring).get('school') || ''
      this.refs.container.innerHTML = `<page-action id="${ctx.params.id}" school-id="${this.schoolId}" />`
      riot.mount('page-action')
      this.update()
    })

    this.on('mount', () => {
      page()
      document.body.classList.add('ready')
    })
  </script>


  <style scoped>
    header {
      padding-top: 3rem;
      margin-bottom: 3rem;
      border-bottom-style: solid;
      border-width: 0 0 3px 0; /* Safari fix */
      border-image: linear-gradient(
        to right,
        #4f2559 calc(100%/6),
        #ea8323 calc(100%/6),
        #ea8323 calc((100%/6)*2),
        #7d932d calc((100%/6)*2),
        #7d932d calc((100%/6)*3),
        #209fd6 calc((100%/6)*3),
        #209fd6 calc((100%/6)*4),
        #f7da34 calc((100%/6)*4),
        #f7da34 calc((100%/6)*5),
        #dd0e29 75%
      ) 5;
      background-color: #fbfbff;
    }
    header section {
      margin-top: 3rem;
      border-top: 2px solid #f6f6f6;
      padding: 8rem 1rem;
      background-color: #fff;
    }
    header > a {
      display: grid;
      grid-template:
        ". logo title ."
        ". logo baseline ."
        / 1fr 8rem 38rem 1fr
        ;
      color: inherit;
    }
    header #beta {
      display: block;
      width: 100%;
      max-width: 250px;
      float: left;
    }
    header > a #logo {
      grid-area: logo;
    }
    header > a h1 {
      grid-area: title;
      font-size: 1.4em;
      margin: .4em 0 0 1rem;
      align-self: end;
      font-weight: normal;
    }
    header > a h2 {
      grid-area: baseline;
      font-size: 1em;
      margin: 0 0 1rem 1rem;
    }
    header > p {
      max-width: 50rem;
      text-align: center;
      font-size: 2.5rem;
      font-weight: 100;
      margin: 2rem auto 0 auto;
    }

    footer {
      background-color: #fff;
      padding: 5rem 2rem 2rem 2rem;
      display: grid;
      grid-template:
        '. nav section';
    }
    footer nav {
      grid-area: nav;
    }
    footer nav h2 {
      display: inline-block;
      border-bottom: 1px solid;
      font-size: 1.1em;
      margin-bottom: .2em;
      font-weight: 600;
    }
    footer nav a {
      display: block;
      color: inherit;
      list-style-type: disc;
    }
    footer section {
      grid-area: section;
      justify-self: center;
      align-self: end;
    }
    footer section img {
      height: 100px;
    }
    footer nav a:hover {
      text-decoration: underline;
    }
  </style>
</app>
