<select-school>
  <input type=search ref=input placeholder="Ex : LycÃ©e Jean Moulin Paris" required>

  <script>
    function normalizeString (str) {
      return str.toLowerCase().normalize('NFD').replace(/[\u0300-\u036f]/g, '')
    }

    this.displaySchool = (school) => {
      return `${school.name} (${school.postalCode} ${school.city})`
    }

    this.on('mount', async () => {
      let id

      const completer = new Awesomplete(this.refs.input, {
        replace: function (suggestion) {
          this.input.value = suggestion.label
          id = suggestion.value
        },
        filter: function (text, input) {
          const words = normalizeString(input).split(' ')
          return words.filter(word => normalizeString(text.label).includes(word)).length === words.length
        },
        item: function (text, input) {
          return Awesomplete.ITEM(text.label, '')
        }
      })

      this.refs.input.addEventListener('input', async event => {
        const q = event.target.value
        if (!q || q.length < 3) {
          return
        }
        const schools = await api(`/schools/search/${q}`)
        completer.list = schools && schools.map(s => {
          return {
            label: this.displaySchool(s),
            value: s._id
          }
        })
      })

      const school = await api(`/schools/${this.opts.schoolId}`)
      this.refs.input.value = this.displaySchool(school)
      debugger

      this.refs.input.addEventListener('awesomplete-selectcomplete', event => {
        page(`/school/${id}/search`)
      })
    })
  </script>

  <style>
    input,
    .awesomplete > input {
      width: 100% !important;
    }
    .awesomplete {
      display: block;
      width: 100%;
    }
  </style>
</select-school>
