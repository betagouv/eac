<page-actor>
  <article>
    <section class="block actor">
      <h2>{ this.actor.name }</h2>
      <nav class=tags>
        <a class=tag each={ tag in this.actor.domains }>{ tag }</a>
      </nav>
      <p if={ this.actor.description }>{ this.actor.description }</p>
      <p if={ !this.actor.description }>
        Cet acteur culturel n'a pas renseigné ses informations.<br>
        <a class=button href="https://duckduckgo.com/?q={ encodeURI(`${this.actor.name} ${this.actor.city}`) }" target=_blank>Faire une recherche</a>
      </p>
    </section>

    <section class="block actions">
      <h2>Actions proposées</h2>
      <article>
        <p if={ this.actor.actions }>{ this.actor.actions }</p>
        <p if={ !this.actor.actions }>Les actions proposées par cet acteur sont sur demande.<br>
        Veillez à prendre contact avec cet Acteur Culturel.</p>
      </article>
    </section>

    <aside>
      <section class=block id=contact>
        <h3>Contacter { this.contact }</h3>
        <ul>
          <li if={ this.phone }>Par téléphone : { this.phone }</li>
          <li if={ this.email }>Par email : { this.email }</li>
        </ul>
        <a if={ this.email } class=button target="_blank" href="mailto:{ this.email }?subject=À propos de { this.actor.name }&cc=loup.wolff@beta.gouv.fr&body={ encodeURIComponent(this.emailBody) }">Envoyer un email</a>
        <a if={ this.phone } class=button href="tel:{ this.phone }">Appeler</a>
        <p if={ !this.phone && !this.email }>
          Aucune information de contact n'est disponible pour cet acteur culturel.<br>
          <a class=button href="https://duckduckgo.com/?q={ encodeURI(`${this.actor.name} ${this.actor.city}`) }" target=_blank>Faire une recherche</a>
        </p>
      </section>

      <section class=block>
        <geo if={ this.actor.distance }>à { Math.ceil(this.actor.distance) }}&nbsp;km</geo>
        <address if={ this.latLng }>
          <iframe width=425 height=350 frameborder=0 scrolling=no marginheight=0 marginwidth=0 src="https://www.openstreetmap.org/export/embed.html?bbox={ Number(this.latLng[1]) - 0.02 }%2C{ Number(this.latLng[0]) - 0.02 }%2C{ Number(this.latLng[1]) + 0.02 }%2C{ Number(this.latLng[0]) + 0.02 }&amp;layer=hot&amp;marker={ this.latLng[0] }%2C{ this.latLng[1] }"></iframe><br/>
          <small>
            <a href="https://www.openstreetmap.org/?mlat={ this.latLng[0] }&mlon={ this.latLng[1] }#map=15/{ this.latLng[0] }/{ this.latLng[1] }&layers=T" target=_blank>
              { this.actor.address }<br>
              { this.actor.postalCode } { this.actor.city }
            </a>
          </small>
        </address>
      </section>
    </aside>

  </article>

  <script>
    /* global api, opts, location */
    this.actor = {}

    this.on('mount', async () => {
      this.actor = await api(`/actors/${opts.actorId}`)
      this.phone = this.actor.contactPhone || this.actor.ownerPhone
      this.email = this.actor.contactEmail || this.actor.ownerEmail
      this.latLng = this.actor.loc.coordinates[0] && this.actor.loc.coordinates
      this.contact = (this.actor.contactName || this.actor.ownerName).replace(',', '')
      this.emailBody = `Bonjour ${this.contact},\n\n` +
        `Je vous contacte suite à ma consultation de la fiche ${location.href}.\n\n` +
        `Questions ou remarques :\n\n\n\n`
      this.update()
    })
  </script>

  <style scoped>
    :scope {
      display: grid;
      grid-template:
        'actor aside'
        'actions aside'
        / auto 51rem;
    }
    :scope > article {
      display: contents;
    }
    .actor {
      grid-area: actor;
    }
    .actions {
      grid-area: actions;
    }
    aside {
      grid-area: aside;
    }

    .actions article:not(:last-of-type) {
      padding-bottom: 1rem;
      margin-bottom: 1rem;
      border-bottom: 1px solid #ccc;
    }

    .actor > nav {
      margin-bottom: 1rem;
    }
  </style>
</page-actor>
