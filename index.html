<!doctype html>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1">
<link rel=stylesheet href="//fonts.googleapis.com/css?family=Roboto:300,300italic,700,700italic">
<link rel=stylesheet href=//cdn.rawgit.com/necolas/normalize.css/master/normalize.css>
<link rel=stylesheet href=./css/milligram.min.css>

<style>
body {
  background-color: #f8f8f8;
}

body > header {
  padding: .5rem !important;
}
body > header {
  display: grid;
  grid-template:
    ". logo title ."
    ". logo baseline ."
    / 1fr 150px auto 1fr
    ;
}
body > header #logo {
  grid-area: logo;
}
body > header h1 {
  grid-area: title;
  font-size: 2em;
  margin: .4em 0 0 0;
  align-self: end;
}
body > header h2 {
  grid-area: baseline;
  font-size: 1em;
  font-weight: 200;
}

.block {
  background-color: #fff;
  margin: 0 1em 1em 0;
  padding: 2em;
  box-shadow: .3em .3em .2em #eee;
}
.block h2 {
  text-align: center;
}

.disabled {opacity: .3}
.loading {
  position: fixed;
  width: 300px;
  height: 300px;
  background: url(images/loading.gif) no-repeat center center;
  top: calc(50% - 150px);
  left: calc(50% - 150px);
}

.tag {
  display: inline-block;
  padding: .3rem 1rem;
  border-radius: .3rem;
  font-size: 1.1rem;
  font-style: italic;
  background: #eee;
  color: inherit;
  cursor: default;
}
.tag:not(:last-of-type) {
  margin-right: 1rem;
}
</style>


<header class=block>
  <img id=logo src=images/logo-eac.gif alt="Logo de la Pleateforme EAC">
  <h1>Pleateforme EAC</h1>
  <h2>L'Éducation artistique et culturelle à votre portée</h2>
</header>

<main><div class=loading></div></main>

<script type=riot/tag src=./tags/checkbox.tag.html></script>
<script type=riot/tag src=./tags/page-home.tag.html></script>
<script type=riot/tag src=./tags/page-search.tag.html></script>
<script type=riot/tag src=./tags/poi-card.tag.html></script>
<script type=riot/tag src=./tags/poi-cards.tag.html></script>
<script src=./js/riot+compiler.min.js></script>
<script src=./js/utils.js></script>
<script src=./js/fuse.min.js></script>
<script src=./js/route.min.js></script>
<script src=./js/airtable-storage.js></script>
<script>
  const db = new AirtableStorage('a2V5VnF0SVlyN3l1U1VnTXc=', 'appQXPPR2DMoc3B6N')
  var searchablePois = null
  const container = document.querySelector('main')
  const searchablePoisOptions = {
    keys: [{
      name: 'Nom',
      weight: 0.8
    }, {
      name: 'Type',
      weight: 0.5
    }, {
      name: 'Description',
      weight: 0.3
    }]
  }
  var store = {}

  route('/', () => {
    container.innerHTML = '<page-home></page-home>'
    console.log(db.data.schools)
    riot.mount('page-home', { data: db.data.pois, schools: db.data.schools })
  })
  route('/search?q=..', () => {
    container.innerHTML = '<page-search></page-search>'
    const filters = JSON.parse(decodeURI(route.query().filters))
    riot.mount('page-search', {
      filters,
      q: decodeURI(route.query().q),
      data: db.data.pois
    })
  })
  route.base('#!/')

  db.load().then(data => {
    searchablePois = new Fuse(data.pois, searchablePoisOptions)
    console.info('db is loaded', data)
    route.start(true)
  })
  .catch(e => alert(e))
</script>
